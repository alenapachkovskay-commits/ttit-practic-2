{% extends "base_generic.html" %}

{% block title %}Мои заявки | Design.pro{% endblock %}

{% block content %}
<h2>Мои заявки</h2>

<!-- Фильтр по статусу -->
<form method="get">
    <label for="status">Фильтр по статусу:</label>
    <select name="status" id="status">
        <option value="">Все</option>
        <option value="new" {% if status_filter == "new" %}selected{% endif %}>Новая</option>
        <option value="in_progress" {% if status_filter == "in_progress" %}selected{% endif %}>Принято в работу</option>
        <option value="completed" {% if status_filter == "completed" %}selected{% endif %}>Выполнено</option>
    </select>
    <button type="submit">Применить</button>
</form>

<table>
    <thead>
        <tr>
            <th>Дата</th>
            <th>Название</th>
            <th>Описание</th>
            <th>Категория</th>
            <th>Статус</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        {% for req in requests %}
        <tr>
            <td>{{ req.created_at|date:"d.m.Y H:i" }}</td>
            <td>{{ req.title }}</td>
            <td>{{ req.description|truncatechars:50 }}</td>
            <td>{{ req.category.name }}</td>
            <td>{{ req.get_status_display }}</td>
            <td>
                <a href="{% url 'request-detail' req.id %}">Просмотреть</a>
                {% if req.can_be_deleted %}
                    <a href="{% url 'delete_request' req.id %}">Удалить</a>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="6">У вас пока нет заявок.</td></tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}